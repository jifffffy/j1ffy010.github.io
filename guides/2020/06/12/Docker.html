<!doctype html>
<html>
<head>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
    <title>Docker for Rails developers</title>
    

    <link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Jekyll AsciiDoc Blog" />
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Docker for Rails developers | Jekyll AsciiDoc Blog</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Docker for Rails developers" />
<meta name="author" content="Jiffy" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="记录学习《Docker for Rails developers》时遇到的一些问题。" />
<meta property="og:description" content="记录学习《Docker for Rails developers》时遇到的一些问题。" />
<meta property="og:site_name" content="Jekyll AsciiDoc Blog" />
<meta property="og:image" content="/docker.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-12T00:00:00+00:00" />
<script type="application/ld+json">
{"description":"记录学习《Docker for Rails developers》时遇到的一些问题。","author":{"@type":"Person","name":"Jiffy"},"@type":"BlogPosting","url":"/guides/2020/06/12/Docker.html","image":"/docker.jpg","headline":"Docker for Rails developers","dateModified":"2020-06-12T00:00:00+00:00","datePublished":"2020-06-12T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"/guides/2020/06/12/Docker.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <meta name="Keywords" content="">
    <link href="/assets/images/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="The Jekyll AsciiDoc Quickstart project is a leg-up in starting your own website hosted on GitHub with content based in AsciiDoc.">
    <meta name="author" content="Your name goes here">
    <meta name="copyright" content="Maybe consider a Creative Commons license">

    <!--<link rel="stylesheet" href="/assets/css/foundation.css">
    <link rel="stylesheet" href="/assets/css/coderay.css">-->
    <link rel="stylesheet" href="/assets/css/font-awesome.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link href="/assets/css/R.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/layer.css" id="layui_layer_skinlayercss" style="">
    <link rel="stylesheet" href="/assets/css/themes/rubygems.css">

</head>
<body id="mescroll" class="mescroll">
<div class="c pink">
    <div class="con head">
        <a title="" href="" class="logo">
            <img alt="Logo" class="pclogo" src="/assets/images/Logo.png">
            <img alt="Logo" class="mobilelogo hide" src="/assets/images/mobile_logo.png">
        </a>

        <span class="menuebtn"></span>
    </div>
</div>
<div class="c white">
    <div class="nav show">
        <ul>
            
<li><a href="/" >首页</a></li>

<li><a href="/404.html" >暂无</a></li>

<li><a href="/404.html" >暂无</a></li>

<li><a href="/404.html" >暂无</a></li>

<li><a href="/404.html" >暂无</a></li>

<li><a href="/404.html" >暂无</a></li>


        </ul>
    </div>
</div>
<div id="body">
    <section class="content-wrapper main-content clear-fix">
        <div class="c top20">
            <div class="con">
                <div class="detailcontent">
    <div class="detail">
        <div class="detailcon">
            
            <a title="Docker for Rails developers" href="/authors/Jiffy.html" class="detailuser">
                <img alt="Docker for Rails developers" src="/assets/images/users/devlopr.png">
                <span>
                    <font class="username">Jiffy</font>
                    <font class="date">12 Jun 2020</font>
                </span>
            </a>
            <div class="arttag">
                
                <a  title="Windows Docker Rails Ruby" href="/blog/tags/Windows Docker Rails Ruby" class="t1">Windows Docker Rails Ruby</a>
                
            </div>
            <div class="detailadoc">
                <div class="sect1">
<h2 id="简介">简介</h2>
<div class="sectionbody">
<div class="paragraph">
<p>这是我学习使用Docker开发Rails项目做的记录,主要记录遇到的一些问题。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="安装">安装</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在Win7下使用Docker只能使用DockerToolbox.exe安装。</p>
</div>
<div class="paragraph">
<p><strong>注意:</strong> 如果之前在电脑上装过Docker,卸载后重新安装的时候,可能会遇到证书错误的问题。按照错误提示，
简单的把C:\Users\用户\.docker\machine\certs目录下的ca.pem文件复制到C:\Users\用户\.docker\machine\machines\default目录中即可。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="启动">启动</h2>
<div class="sectionbody">
<div class="paragraph">
<p>安装成功后,windows用户需首先点击"Docker Quickstart Terminal"快捷方式，该快捷方式会执行start.bat脚本下载一个叫"boot2docker.iso"的镜像文件。</p>
</div>
<div class="paragraph">
<p><strong>注意:</strong> 由于众所周知的原因,下载这个文件极有可能失败,引用知乎上的解决方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>目前国内访问github的体验, 首先http://github.com里的各种页面访问都没问题, 速度还好.
release中的下载链接虽然是http://github.com开头,但会跳转到*.s3.amazonaws.com这个域名, 后面带了很长的参数, 貌似是一次性的只能临时下载用, 很快就会失效,
然后只能从github.com开头的地址重新跳转取得新的实际下载链接.
至于release的下载速度, 最快只有几十KB/s, 慢的时候可能掉到十几K甚至几K. 如果把跳转后的真实下载链接中的https手动改为http开头, 则下载速度会提高到几百K甚至更高. 怀疑是https有墙在阻碍.
然而, release下载的稳定性并不好, 如果下载文件很大, 很容易在中途中断(http方式下载还经常在99%的进度中断), chrome浏览器无法断点续传, 因为临时下载地址会失效. 不少下载工具也无法处理好地址跳转,
不过curl实测可以从http://github.com开头的原链接断点续传, 但又无法解决https改为http, 只能龟速下载但中断可续传.</pre>
</div>
</div>
<div class="paragraph">
<p>采用把<strong>https</strong>换成<strong>http</strong>的方式下载boot2docker.iso文件，下载完成后，放到C:\Users\用户\.docker\machine\cache目录下。然后再点击"Docker Quickstart Terminal"快捷方式。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="执行">执行</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在执行命令的时候,由于windows的路径问题,需要特别注意,另外在共享主机目录的时候,需要写绝对路径,如:
在linux下应该为:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ​​docker​​ ​​run​​ ​​-i​​ ​​-t​​ ​​--rm​​ ​​-v​​ ​​${PWD}:/usr/src/app​​ ​​ruby:2.6​​ ​​bash​</pre>
</div>
</div>
<div class="paragraph">
<p>下windows下却为:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ​​docker​​ ​​run​​ ​​-i​​ ​​-t​​ ​​--rm​​ ​​-v​​ /c/Users/sun/test:/usr/src/app​​ ​​ruby:2.6​​ ​​bash​</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ruby">Ruby</h2>
<div class="sectionbody">
<div class="paragraph">
<p>由于众所周知的原因,在下载gem包的时候,需要设置国内的镜像源:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/  &amp;&amp; bundle config mirror.https://rubygems.org https://gems.ruby-china.com</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="docker">Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>获取container IP地址:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>​​$ ​​docker​​ ​​ps​
  ​ CONTAINER ID IMAGE more info
  ​ d7230c4b0595 e28cf982ae39 .........

​$ ​​docker​​ ​​inspect​​ ​​--format​​ ​​'{{ .NetworkSettings.IPAddress }}'​​ ​​d7230c4b0595​
   172.17.0.2</pre>
</div>
</div>
<div class="sect2">
<h3 id="docker_compose">Docker compose</h3>
<div class="paragraph">
<p>执行流程：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creates a separate network just for the app:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>Creating network "myapp_default" with the default driver</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By convention, Compose names the network &lt;appname&gt;_default , where appname is
      inferred from the containing directory.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates any non-locally mounted volumes defined for the app</p>
</li>
<li>
<p>Builds an image for any services with a build directive</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Building web
​ Step 1/8 : FROM ruby:2.6
​ ​ ---&gt;​​ ​​f28a9e1d0449​
​ Step 2/8 : LABEL maintainer="rob@DockerForRailsDevelopers.com"
​ ​ ---&gt;​​ ​​Using​​ ​​cache​
​ ​ ---&gt;​​ ​​d69ea7d90f89​
​ Step 3/8 : RUN apt-get update -yqq &amp;&amp; apt-get install -yqq --no-install-
​ recommends nodejs
​ ​ ---&gt;​​ ​​Using​​ ​​cache​
​ ​ ---&gt;​​ ​​463750079bef​
​ ...
​ Step 8/8 : CMD ["bin/rails", "s", "-b", "0.0.0.0"]
​ ​ ---&gt;​​ ​​Running​​ ​​in​​ ​​b11e989011fc​
​ Removing intermediate container b11e989011fc
​ ​ ---&gt;​​ ​​a18b3079c84b​
​ Successfully built a18b3079c84b</pre>
</div>
</div>
<div class="paragraph">
<p>Compose gives the image a name and version by tagging it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Successfully tagged myapp_web:latest</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
using the convention &lt;appname&gt;_&lt;service_name&gt;:latest , again inferring the appname
      from the enclosing directory. In our case, this becomes myapp_web:latest
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Image for service web was built because it did not already exist.
  ​ To rebuild this image you must use <code>docker-compose build</code> or <code>docker-compose
  ​ up --build</code>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates a container for each service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>Creating myapp_web_1 &#8230;&#8203; done</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Compose creates and starts a single container for our web service based on
      the image it has just created. It will name containers using the format
      <code>&lt;appname&gt;_&lt;service name&gt;_&lt;n&gt;</code>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Launches a container per service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>Attaching to myapp_web_1</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In a process known as attaching, Compose then connects our local IO streams
     ( stdin , stdout , and stderr ) to the running container
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a result, we’re able to see our Rails server starting inside the container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>web_1 | =&gt; Booting Puma
​ web_1 | =&gt; Rails 5.2.2 application starting in development
​ web_1 | =&gt; Run `rails server -h` for more startup options
​ web_1 | Puma starting in single mode...
​ web_1 | * Version 3.12.0 (ruby 2.6.0-p0), codename: Llamas in Pajamas
​ web_1 | * Min threads: 5, max threads: 5
​ web_1 | * Environment: development
​ web_1 | * Listening on tcp://0.0.0.0:3000
​ web_1 | Use Ctrl-C to stop</pre>
</div>
</div>
<div class="sect3">
<h4 id="docker_生命周期">Docker 生命周期</h4>
<div class="imageblock">
<div class="content">
<img src="/assets/images/20200612/life_cycle.jpg" alt="life cycle">
</div>
</div>
</div>
<div class="sect3">
<h4 id="running_one_off_commands">Running One-Off Commands</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>docker-compose run</p>
<div class="literalblock">
<div class="content">
<pre>$ ​​docker-compose​​ ​​run​​ ​​--rm​​ ​​web​​ ​​echo​​ ​​'ran a different command'​
ran a different command</pre>
</div>
</div>
</li>
<li>
<p>docker-compose exec</p>
<div class="literalblock">
<div class="content">
<pre>$ ​​docker-compose​​ ​​exec​​ ​​web​​ ​​echo​​ ​​'ran a different command'​
ran a different command</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="cleaning_up">Cleaning Up</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>docker-compose down</code> command stops any running containers and
removes them along with the app’s dedicated network and volumes.</p>
</li>
<li>
<p>If you just want to remove the app’s containers, there’s the
<code>docker-compose rm</code> command for this purpose.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
As we change our Dockerfile and rebuild images, some images
         inevitably will no longer be needed or used, yet sit there taking up
         precious disk space. These are known as dangling images; they can
         be removed with the <code>docker image prune</code> command.
         There’s an entire family of prune commands to free up other unused
         resources (for example, <code>docker container prune</code> ). There’s even a
         single command to free up all resources in one go:
         <code>$ docker system prune</code>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
            </div>
        </div>
    </div>
    <div class="comment" id="Comment">
        <div class="recomment">
            <textarea id="TBComment" class="colorgray">期待你的论...</textarea>
            <span class="btn right right" onclick="SubmitCommentByArt(3317370)">评论</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <script>
        var gitalk  = new Gitalk ({
            id: window.location.pathname,   // Ensure uniqueness and length less than 50
            clientID: 'e6a309ad3bd8766be265',
            clientSecret: '00c1c086d60c9e31d0276f688dde7717d5f79a24',
            repo: 'sunyuyangg555.github.io',
            owner: 'sunyuyangg555',
            admin: ['sunyuyangg555'],
            distractionFreeMode: false  // Facebook-like distraction free mode
        });
        gitalk.render('Comment')
    </script>
</div>

                <div class="rightarea">
    <a  target="_blank" title="联系" class="submission" href="https://github.com/sunyuyangg555/">联系我</a>
    <div class="hottag">
    <h2>类别<a title="类别" href="/categories_all.html">更多&gt;&gt;</a></h2>
     
    <a href="/blog/categories/guides" class="t1">guides</a>
     
    <a href="/blog/categories/test" class="t2">test</a>
    
</div>
    <div class="hottag">
    <h2>标签<a title="标签库" href="/tags_all.html">更多&gt;&gt;</a></h2>
     
    <a href="/blog/tags/java" class="t1">java</a>
     
    <a href="/blog/tags/sleep" class="t2">sleep</a>
     
    <a href="/blog/tags/Virtual" class="t3">Virtual</a>
     
    <a href="/blog/tags/Test" class="t4">Test</a>
     
    <a href="/blog/tags/Windows Docker Rails Ruby" class="t5">Windows Docker Rails Ruby</a>
     
    <a href="/blog/tags/Windows Unix" class="t6">Windows Unix</a>
     
    <a href="/blog/tags/Windows Docker" class="t7">Windows Docker</a>
    
</div>
    <div class="hotuser">
    <h2>作者</h2>
    <ul>
        
        <li>
            <a  href="/authors/Jiffy.html" title="Jiffy">
                <img alt="Jiffy" src="/assets/images/users/devlopr.png">
                <span>
                    <font class="username">Jiffy</font>
                    <font class="userdes">Java, Ruby, Devops, Linux</font>
                </span>
            </a>
        </li>
        
    </ul>
</div>


</div>


            </div>
        </div>
        <ul class="toolbtn">
            <!--<li class="toolsubmi"><a title="投稿"></a></li>-->
            <li class="toup hide" title="滑到顶部"></li>
        </ul>
    </section>
</div>

<span id="Share_Title" class="hide"></span>

<span id="Share_Desc" class="hide"></span>

<span id="Share_ImgUrl" class="hide"></span>

<div class="c top60">
    <div class="con bottominfo">
        <ul class="bottomnav">
            
            <li><a href="/About.html" >关于我们</a></li>
            
            <li><a href="/ContactUs.html" >联系我们</a></li>
            
            <li><a href="/Helper.html" >使用帮助</a></li>
            
            <li><a href="/UserProtocol.html" >用户协议</a></li>
            
            <li><a href="/Complaint.html" >投诉建议</a></li>
            
        </ul>

        <div class="firlink">
            <span>友情链接：</span>
            
            <a href="http://www.github.com/">github</a>
            
        </div>
        <span class="icp"></span>
        <span class="address"></span>
    </div>
</div>

<script src="/assets/js/vendor/jquery.js"></script>
<!--<script src="/assets/js/jquery-1.11.1.min.js"></script>-->
<script src="/assets/js/foundation.min.js"></script>
<script src="/assets/js/layer.js"></script>
<script src="/assets/js/app.js"></script>
<script src="/assets/js/jweixin-1.2.0.js"></script>
<script src="/assets/js/vendor/modernizr.js"></script>
<script src="/assets/js/toc.js"></script>
<script>
    $(document).foundation();
    var doc = document.documentElement;
    doc.setAttribute('data-useragent', navigator.userAgent);
</script>
</body>
</html>
